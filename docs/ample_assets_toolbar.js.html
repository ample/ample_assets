<!DOCTYPE html>  <html> <head>   <title>ample_assets_toolbar.js.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               ample_assets_toolbar.js.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>AmpleAssets</strong> is drag and drop file management for Rails applications. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">AmpleAssetsToolbar</span> <span class="k">extends</span> <span class="nx">CoffeeCup</span>
  
  <span class="nv">default_options: </span>
    <span class="nv">debug: </span><span class="kc">false</span>
    <span class="nv">expanded: </span><span class="kc">false</span>
    <span class="nv">id: </span><span class="s2">&quot;ample-assets&quot;</span>
    <span class="nv">handle_text: </span><span class="s1">&#39;Assets&#39;</span>
    <span class="nv">expanded_height: </span><span class="mi">180</span>
    <span class="nv">collapsed_height: </span><span class="mi">0</span>
    <span class="nv">base_url: </span><span class="s1">&#39;/ample_assets&#39;</span>
    <span class="nv">search_url: </span><span class="s1">&#39;/files/search&#39;</span>
    <span class="nv">thumb_url: </span><span class="s1">&#39;/files/thumbs&#39;</span>
    <span class="nv">show_url: </span><span class="s1">&#39;/files/{{ id }}&#39;</span>
    <span class="nv">touch_url: </span><span class="s1">&#39;/files/{{ id }}/touch&#39;</span>
    <span class="nv">gravity_url: </span><span class="s1">&#39;/files/{{ id }}/gravity&#39;</span>
    <span class="nv">onInit: </span><span class="o">-&gt;</span>
    <span class="nv">onExpand: </span><span class="o">-&gt;</span>
    <span class="nv">onCollapse: </span><span class="o">-&gt;</span>
    <span class="nv">panels_options:</span>
      <span class="nv">debug: </span><span class="kc">false</span>
      <span class="nv">width: </span><span class="mi">950</span>
      <span class="nv">height: </span><span class="mi">100</span>
      <span class="nv">orientation: </span><span class="s1">&#39;vertical&#39;</span>
      <span class="nv">key_orientation: </span><span class="s1">&#39;vertical&#39;</span>
      <span class="nv">keyboard_nav: </span><span class="kc">true</span>
      <span class="nv">auto: </span><span class="kc">false</span>
      <span class="nv">parent: </span><span class="s1">&#39;div&#39;</span>
      <span class="nv">children: </span><span class="s1">&#39;div.page&#39;</span>
    <span class="nv">pages_options:</span>
      <span class="nv">interval: </span><span class="mi">5000</span>
      <span class="nv">width: </span><span class="mi">81</span> 
      <span class="nv">height: </span><span class="mi">81</span>
      <span class="nv">enabled: </span><span class="kc">true</span>
      <span class="nv">distance: </span><span class="mi">10</span>
      <span class="nv">auto: </span><span class="kc">false</span>
      <span class="nv">orientation: </span><span class="s1">&#39;horizontal&#39;</span>
      <span class="nv">key_orientation: </span><span class="s1">&#39;horizontal&#39;</span>
      <span class="nv">per_page: </span><span class="mi">10</span>
    <span class="nv">pages: </span><span class="p">[</span>
      <span class="p">{</span> 
        <span class="nv">id: </span><span class="s1">&#39;recent-assets&#39;</span><span class="p">,</span> 
        <span class="nv">title: </span><span class="s1">&#39;Recently Viewed&#39;</span><span class="p">,</span>
        <span class="nv">url: </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nv">panels: </span><span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Initialize product toolbar and drop targets. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">init: </span><span class="o">-&gt;</span>
    <span class="nx">@options</span><span class="p">.</span><span class="nx">onInit</span><span class="p">()</span>
    <span class="k">super</span>
    <span class="nx">@setup</span><span class="p">()</span>
    <span class="nx">@events</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Setup global parameters &amp; class options. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">set_options: </span><span class="nf">(opts) -&gt;</span>
    <span class="vi">@current = </span><span class="mi">0</span>
    <span class="vi">@keys_enabled = </span><span class="kc">true</span>
    <span class="vi">@reloading = </span><span class="kc">false</span>
    <span class="vi">@searching = </span><span class="kc">false</span>
    <span class="vi">@loaded = </span><span class="kc">false</span>
    <span class="k">super</span>
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Build structure and stylize layout of toolbar, setup drag, drop and search logic.
Opens first tab if toolbar is expanded on init.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setup: </span><span class="o">-&gt;</span>
    <span class="nv">id = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">id</span>
    <span class="nv">layout = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">@tpl</span><span class="p">(</span><span class="s1">&#39;layout&#39;</span><span class="p">),{</span> <span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">pages: </span><span class="nx">@get_pages</span><span class="p">(),</span> <span class="nv">tabs: </span><span class="nx">@get_pages</span><span class="p">(</span><span class="s1">&#39;tab&#39;</span><span class="p">)</span> <span class="p">})</span>
    <span class="vi">@handle = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">@tpl</span><span class="p">(</span><span class="s1">&#39;handle&#39;</span><span class="p">),{</span> <span class="nv">id: </span><span class="nx">id</span><span class="p">,</span> <span class="nv">title: </span><span class="nx">@options</span><span class="p">.</span><span class="nx">handle_text</span> <span class="p">})</span>
    <span class="nv">html = </span><span class="nx">$</span><span class="p">(</span><span class="nx">layout</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">@handle</span><span class="p">)</span>
    <span class="nx">@style</span><span class="p">()</span>
    <span class="nx">@drag_drop</span><span class="p">()</span>
    <span class="nx">@search</span><span class="p">()</span>
    <span class="nx">@goto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">expanded</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Set initial styles on toolbar elements.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">style: </span><span class="o">-&gt;</span>
    <span class="nv">handle_opts = </span>
      <span class="nv">position: </span><span class="s1">&#39;absolute&#39;</span>
      <span class="nv">bottom: </span><span class="mi">0</span>
      <span class="nv">right: </span><span class="mi">0</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id}-handle&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="nx">handle_opts</span><span class="p">)</span>
    
    <span class="vi">@loading = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id}-tabs span.asset-loading&quot;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id} .container&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">expanded</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id}&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span><span class="nx">@options</span><span class="p">.</span><span class="nx">expanded_height</span><span class="p">});</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Reloads tab identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reload: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;reload(#{i})&quot;</span>
    <span class="vi">@reloading = </span><span class="kc">true</span>
    <span class="k">if</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> 
      <span class="nx">@empty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;loaded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;pages_loaded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;last_request_empty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;goto&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">@goto</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nx">@enable_panel</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Empties the contents of the page identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">empty: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;empty(#{i})&quot;</span>
    <span class="nv">selector = </span><span class="s2">&quot;##{@options.id} .pages .page:nth-child(#{(i+1)})&quot;</span> 
    <span class="nx">selector</span> <span class="o">+=</span> <span class="s2">&quot; ul&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panels&#39;</span><span class="p">]</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">empty</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Hide and deactivate current page, load next page identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">goto: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;goto(#{i})&quot;</span>
    <span class="nx">@show</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="nx">@disable_panels</span><span class="p">()</span>
    <span class="nx">@activate</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="nx">@load</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">@already_loaded</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="nx">@enable_panel</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@already_loaded</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Hide all pages, show page identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">show: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id} .pages .page&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id} .pages .page:nth-child(#{i+1}), ##{@options.id} .pages .page:nth-child(#{i+1}) ul&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Implement drag &amp; droppable instances, with appropriate callbacks.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drag_drop: </span><span class="o">-&gt;</span>
    <span class="nv">base_url = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">base_url</span>
    <span class="nv">thumb_url = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">thumb_url</span>
    <span class="nv">ref = </span><span class="k">this</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Note the use of liveDraggable here. See extended plugin at the bottom of this file.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.draggable&quot;</span><span class="p">).</span><span class="nx">liveDraggable</span>
      <span class="nv">appendTo: </span><span class="s2">&quot;body&quot;</span>
      <span class="nv">helper: </span><span class="s2">&quot;clone&quot;</span>
      <span class="nv">start: </span><span class="o">-&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.ui-droppable, textarea.ui-droppable&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;asset-drop-target&#39;</span><span class="p">)</span>
      <span class="nv">stop: </span><span class="o">-&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.ui-droppable, textarea.ui-droppable&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;asset-drop-target&#39;</span><span class="p">)</span>
    
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;textarea&quot;</span><span class="p">).</span><span class="nx">droppable</span>
      <span class="nv">activeClass: </span><span class="s2">&quot;asset-notice&quot;</span>
      <span class="nv">hoverClass: </span><span class="s2">&quot;asset-success&quot;</span>
      <span class="nv">drop: </span><span class="nf">(event, ui) -&gt;</span>
        <span class="nx">unless</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">helper</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;gravity&#39;</span>
          <span class="nv">ref.target_textarea = </span><span class="k">this</span>
          <span class="nx">ref</span><span class="p">.</span><span class="nx">resize_modal</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">draggable</span><span class="p">)</span>
    
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.droppable&quot;</span><span class="p">).</span><span class="nx">droppable</span>
      <span class="nv">activeClass: </span><span class="s2">&quot;asset-notice&quot;</span>
      <span class="nv">hoverClass: </span><span class="s2">&quot;asset-success&quot;</span>
      <span class="nv">drop: </span><span class="nf">(event, ui) -&gt;</span>
        <span class="nx">unless</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">helper</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;role&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;gravity&#39;</span>
          <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">html</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">draggable</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
          <span class="nv">asset_id = </span><span class="nx">$</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">draggable</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
          <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">children</span><span class="p">().</span><span class="nx">first</span><span class="p">().</span><span class="nx">val</span> <span class="nx">asset_id</span>
          <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a.asset-remove&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Build html for modal windows wherein users can resize the asset's dimensions &amp; geometry.
Executes when dropping a file into a textarea. The first argument is the response 
from the droppable callbacks defined above.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resize_modal: </span><span class="nf">(el) -&gt;</span>
    <span class="nv">uid = </span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-uid&quot;</span><span class="p">)</span>
    <span class="nv">size = </span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-size&quot;</span><span class="p">)</span>
    <span class="nv">orientation = </span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;data-orientation&quot;</span><span class="p">)</span>
    <span class="nv">base_url = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">base_url</span>
    <span class="nv">thumb_url = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">thumb_url</span>
    <span class="nv">geometry = </span><span class="s1">&#39;100x&gt;&#39;</span>
    <span class="nv">opts = </span>
      <span class="nv">src: </span><span class="s2">&quot;#{base_url}#{thumb_url}/#{geometry}?uid=#{uid}&quot;</span>
      <span class="nv">orientation: </span><span class="nx">orientation</span>
      <span class="nv">dimensions: </span><span class="nx">size</span>
      <span class="nv">uid: </span><span class="nx">uid</span>
    <span class="nv">html = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">@tpl</span><span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">),</span> <span class="nx">opts</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">facebox</span><span class="p">(</span><span class="s2">&quot;&lt;div class=\&quot;asset-detail\&quot;&gt;#{html}&lt;/div&gt;&quot;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Removes active state from all tabs, adds it back for tab identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">activate: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;activate(#{i})&quot;</span>
    <span class="vi">@current = </span><span class="nx">i</span>
    <span class="nv">tabs = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id} a.tab&quot;</span><span class="p">)</span>
    <span class="nx">tabs</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
    <span class="nx">tabs</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Highlight &amp; load next tab (right) by incrementing <code>@current</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">next: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@current</span> <span class="o">&lt;</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="nx">@log</span> <span class="s2">&quot;next()&quot;</span>
      <span class="nx">@current</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">@goto</span><span class="p">(</span><span class="nx">@current</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Highlight &amp; load previous tab (left) by decrementing <code>@current</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">previous: </span><span class="o">-&gt;</span>
    <span class="nx">unless</span> <span class="nx">@current</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nx">@log</span> <span class="s2">&quot;previous()&quot;</span>
      <span class="nx">@current</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="nx">@goto</span><span class="p">(</span><span class="nx">@current</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Loops through all pages, generates HTML and returns concatenated string of everything.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_pages: </span><span class="nf">(tpl = &#39;page&#39;) -&gt;</span>
    <span class="nv">html = </span><span class="s1">&#39;&#39;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span> <span class="p">(</span><span class="nx">idx</span><span class="p">,</span><span class="nx">el</span><span class="p">)</span> <span class="o">=&gt;</span> 
      <span class="nx">el</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;first-child&#39;</span> <span class="k">if</span> <span class="nx">idx</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nx">html</span> <span class="o">+=</span> <span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="nx">@tpl</span><span class="p">(</span><span class="nx">tpl</span><span class="p">),</span> <span class="nx">el</span>
    <span class="nx">html</span>
  </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Expands and collapses asset toolbar.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toggle: </span><span class="o">-&gt;</span>
    <span class="nv">el = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id}&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">expanded</span> 
      <span class="vi">@options.expanded = </span><span class="kc">false</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">animate</span> <span class="p">{</span><span class="s1">&#39;padding-bottom&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span> <span class="s2">&quot;fast&quot;</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">animate</span> <span class="p">{</span><span class="nv">height: </span><span class="nx">@options</span><span class="p">.</span><span class="nx">collapsed_height</span><span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="nx">@collapse</span><span class="p">()</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">onCollapse</span><span class="p">()</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;collapse&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id}-handle&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
      <span class="vi">@options.expanded = </span><span class="kc">true</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">animate</span> <span class="p">{</span><span class="s1">&#39;padding-bottom&#39;</span><span class="o">:</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">expanded_height</span><span class="p">},</span> <span class="s2">&quot;fast&quot;</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">animate</span> <span class="p">{</span><span class="nv">height: </span><span class="nx">@options</span><span class="p">.</span><span class="nx">expanded_height</span><span class="p">},</span> <span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="nx">@expand</span><span class="p">()</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">onExpand</span><span class="p">()</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;expand&#39;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Loads contents of page identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">load: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;load(#{i})&quot;</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nv">load_next_page = </span><span class="kc">true</span> 
    <span class="nv">load_next_page = </span><span class="kc">false</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;last_request_empty&#39;</span><span class="p">]</span>
    <span class="nv">load_next_page = </span><span class="kc">true</span> <span class="k">if</span> <span class="nx">@reloading</span>
    
    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">load_next_page</span>
      <span class="nx">@loading</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nv">url = </span><span class="nx">@next_page_url</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nv">data_type = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">get</span> <span class="nx">url</span><span class="p">,</span> <span class="nf">(response, xhr) -&gt;</span>
        <span class="nx">ref</span><span class="p">.</span><span class="nx">loading</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
        <span class="nx">ref</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;loaded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span> </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>If response is empty, let users know by loading an empty notification.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span>
          <span class="nx">ref</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;last_request_empty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
          <span class="nx">ref</span><span class="p">.</span><span class="nx">load_empty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">if</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">reloading</span> <span class="o">||</span> <span class="o">!</span><span class="nx">ref</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]</span>
        <span class="k">else</span> 
          <span class="k">switch</span> <span class="nx">data_type</span>
            <span class="k">when</span> <span class="s2">&quot;json&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Parse json for requests of that type.</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">ref</span><span class="p">.</span><span class="nx">load_json</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">response</span>
            <span class="k">when</span> <span class="s2">&quot;html&quot;</span>
            <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Parse html by default or for requests of that specific type.</p>             </td>             <td class="code">               <div class="highlight"><pre>              <span class="nx">ref</span><span class="p">.</span><span class="nx">load_html</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">response</span>
      <span class="p">,</span> <span class="nx">data_type</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Notify console if we couldn't load a page due to a missing URL.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@log</span> <span class="s2">&quot;ERROR --&gt; Couldn&#39;t load page because there was no url&quot;</span> <span class="nx">unless</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;last_request_empty&#39;</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>For empty requests, insert notification text into page identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">load_empty: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;load_empty(#{i})&quot;</span>
    <span class="nv">empty = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">@tpl</span><span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">))</span>
    <span class="nx">@load_html</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">empty</span><span class="p">)</span>
    <span class="nx">@loading</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li.empty&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.ampn&#39;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">width</span><span class="p">())</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li.empty a&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span>
      <span class="nx">@goto</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Load html content returned as <code>response</code> by XHR request into page identified by <code>i</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">load_html: </span><span class="nf">(i, response) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;load(#{i}) html&quot;</span>
    <span class="nv">selector = </span><span class="s2">&quot;##{@options.id} .pages .page:nth-child(#{(i+1)})&quot;</span> 
    <span class="nx">selector</span> <span class="o">+=</span> <span class="s2">&quot; ul&quot;</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panels&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="nx">@searching</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">response</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
    <span class="nx">@panels</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Parse <code>response</code> as json data and build list-items for each element contained therein.
This method assumes page identified by <code>i</code> contains an ample_panels instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">load_json: </span><span class="nf">(i, response) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;load(#{i}) json&quot;</span>
    <span class="nv">panels_loaded = </span><span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]</span> <span class="k">then</span> <span class="kc">true</span> <span class="k">else</span> <span class="kc">false</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nv">selector = </span><span class="s2">&quot;##{@options.id} .pages .page:nth-child(#{(i+1)}) ul&quot;</span> 
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">response</span><span class="p">,</span> <span class="nf">(j,el) -&gt;</span>
      <span class="nv">link = </span><span class="nx">ref</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
      <span class="nv">li = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li class=&quot;file&quot;&gt;&lt;/li&gt;&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span>
      <span class="k">if</span> <span class="nx">panels_loaded</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="nx">li</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">li</span><span class="p">)</span>
      <span class="nx">ref</span><span class="p">.</span><span class="nx">load_img</span><span class="p">(</span><span class="nx">li</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="nx">el</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">tn</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
    <span class="nx">@panels</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">panels_loaded</span>
    <span class="k">if</span> <span class="nx">@reloading</span>
      <span class="vi">@reloading = </span><span class="kc">false</span>
      <span class="nx">@controls</span><span class="p">()</span> 
  </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Parse <code>response</code> from search results as json data. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">load_results: </span><span class="nf">(response) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;load_results()&quot;</span>
    <span class="nv">i = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Build list-item for each item returned from search query.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">response</span><span class="p">,</span> <span class="p">(</span><span class="nx">j</span><span class="p">,</span><span class="nx">el</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nv">link = </span><span class="nx">@build</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
        <span class="nv">li = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li class=&quot;file&quot;&gt;&lt;/li&gt;&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#asset-results ul&quot;</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="nx">li</span><span class="p">)</span>
        <span class="nx">@load_img</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="nx">el</span><span class="p">.</span><span class="nx">sizes</span><span class="p">.</span><span class="nx">tn</span><span class="p">)</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>No results were returned, inject no-results verbiage.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">no_results = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span><span class="p">(</span><span class="nx">@tpl</span><span class="p">(</span><span class="s1">&#39;no_results&#39;</span><span class="p">))</span>
      <span class="nx">@load_html</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">no_results</span><span class="p">)</span>
      <span class="nx">@loading</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li.empty&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.ampn&#39;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">width</span><span class="p">())</span>
      
    <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#asset-results ul&quot;</span>
    <span class="vi">@active_panel = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">])</span>
    <span class="vi">@searching = </span><span class="kc">false</span>
    <span class="nx">@loading</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
    <span class="nx">@controls</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Builds each asset instance with proper attributes. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">build: </span><span class="nf">(el) -&gt;</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nv">show_url = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">show_url</span><span class="p">,</span> <span class="p">{</span> <span class="nv">id: </span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="p">}</span>
    <span class="nv">link = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;a href=\&quot;#{@options.base_url}#{show_url}\&quot; draggable=\&quot;true\&quot;&gt;&lt;/a&gt;&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s2">&quot;file-#{el.id}&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-uid&#39;</span><span class="p">,</span><span class="s2">&quot;#{el.uid}&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-filename&#39;</span><span class="p">,</span><span class="s2">&quot;#{el.filename}&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-gravity&#39;</span><span class="p">,</span> <span class="nx">el</span><span class="p">.</span><span class="nx">gravity</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;draggable&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nb">document</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-orientation&#39;</span><span class="p">,</span><span class="nx">el</span><span class="p">.</span><span class="nx">orientation</span><span class="p">)</span>
      <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-size&#39;</span><span class="p">,</span><span class="nx">el</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">click</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Open a modal window on any asset instance's click event.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ref</span><span class="p">.</span><span class="nx">modal_open</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
      <span class="kc">false</span>
    <span class="nx">link</span>
  </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Opens modal window instance for asset detail. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">modal_open: </span><span class="nf">(data) -&gt;</span>
    <span class="vi">@modal_active = </span><span class="kc">true</span>
    <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nb">document</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Asset is a document, so lets instantiate PDFObject for viewing inline.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">html = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="nx">@tpl</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">),</span>
        <span class="nv">filename: </span><span class="nx">data</span><span class="p">.</span><span class="nx">uid</span><span class="p">,</span> 
        <span class="nv">id: </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
        <span class="nv">mime_type: </span><span class="nx">data</span><span class="p">.</span><span class="nx">mime_type</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">facebox</span><span class="p">(</span><span class="s2">&quot;&lt;div class=\&quot;asset-detail\&quot;&gt;#{html}&lt;/div&gt;&quot;</span><span class="p">)</span>
      <span class="nv">myPDF = </span><span class="k">new</span> <span class="nx">PDFObject</span><span class="p">(</span>
        <span class="nv">url: </span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span>
        <span class="nv">pdfOpenParams:</span>
          <span class="nv">view: </span><span class="s2">&quot;Fit&quot;</span>
      <span class="p">).</span><span class="nx">embed</span><span class="p">(</span><span class="s2">&quot;pdf&quot;</span><span class="p">)</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Asset is an image, lets display it inline, according to its orientation. </p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">geometry = </span><span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">orientation</span> <span class="o">==</span> <span class="s1">&#39;portrait&#39;</span> <span class="k">then</span> <span class="s1">&#39;x300&gt;&#39;</span> <span class="k">else</span> <span class="s1">&#39;480x&gt;&#39;</span>
      <span class="nv">url = </span><span class="s2">&quot;#{@options.base_url}#{@options.thumb_url}/#{geometry}?uid=#{data.uid}&quot;</span>
      <span class="nv">delete_url = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">show_url</span><span class="p">,</span> <span class="p">{</span> <span class="nv">id: </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span> <span class="p">}</span>
      <span class="nv">gravity_url = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">gravity_url</span><span class="p">,</span> <span class="p">{</span> <span class="nv">id: </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span> <span class="p">}</span>
      <span class="nv">gravity = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;a[data-uid=&#39;#{data.uid}&#39;]&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-gravity&#39;</span><span class="p">)</span>
      <span class="nv">keywords = </span><span class="s2">&quot;&quot;</span>
      <span class="nv">html = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="nx">@tpl</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">),</span>
        <span class="nv">filename: </span><span class="nx">data</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span> 
        <span class="nv">size: </span><span class="nx">data</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span>
        <span class="nv">mime_type: </span><span class="nx">data</span><span class="p">.</span><span class="nx">mime_type</span><span class="p">,</span>
        <span class="nv">keywords: </span><span class="nx">keywords</span><span class="p">,</span>
        <span class="nv">src: </span><span class="nx">url</span><span class="p">,</span> 
        <span class="nv">orientation: </span><span class="nx">data</span><span class="p">.</span><span class="nx">orientation</span><span class="p">,</span> 
        <span class="nv">id: </span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
        <span class="nv">uid: </span><span class="nx">data</span><span class="p">.</span><span class="nx">uid</span><span class="p">,</span>
        <span class="nv">gravity: </span><span class="nx">gravity</span><span class="p">,</span>
        <span class="nv">delete_url: </span><span class="s2">&quot;#{@options.base_url}#{delete_url}&quot;</span><span class="p">,</span>
        <span class="nv">gravity_url: </span><span class="s2">&quot;#{@options.base_url}#{gravity_url}&quot;</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">facebox</span><span class="p">(</span><span class="s2">&quot;&lt;div class=\&quot;asset-detail\&quot;&gt;#{html}&lt;/div&gt;&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Update the asset timestamp.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@touch</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Create new image element from <code>src</code>, insert into <code>el</code> and fadeIn opacity.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">load_img: </span><span class="nf">(el,src) -&gt;</span>
    <span class="nv">img = </span><span class="k">new</span> <span class="nx">Image</span><span class="p">()</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">img</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span> <span class="k">this</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">()</span>
    <span class="p">).</span><span class="nx">attr</span> <span class="nv">src: </span><span class="nx">src</span>
  </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Generates the next URL for paginated record sets.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">next_page_url: </span><span class="nf">(i) -&gt;</span>
    <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;pages_loaded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="nx">unless</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;pages_loaded&#39;</span><span class="p">]</span>
    <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;pages_loaded&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="s2">&quot;#{@options.pages[i][&#39;url&#39;]}?page=#{@options.pages[i][&#39;pages_loaded&#39;]}&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>By touching asset records, we update the timestamp value which ensures our recently
viewed tab contains accurate results. Called from <code>modal_open()</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">touch: </span><span class="nf">(el) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;touch()&quot;</span>
    <span class="nv">touch_url = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">to_html</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">touch_url</span><span class="p">,</span> <span class="p">{</span> <span class="nv">id: </span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="p">}</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span> <span class="s2">&quot;#{@options.base_url}#{touch_url}&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Instantiate an amplePanels instance within page <code>i</code> if <code>@options.pages[i]['panels']</code> is true.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">panels: </span><span class="nf">(i) -&gt;</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panels&#39;</span><span class="p">]</span>
      <span class="nx">@log</span> <span class="s2">&quot;panels(#{i})&quot;</span>
      <span class="nv">el = </span><span class="s2">&quot;##{@options.id} .pages .page:nth-child(#{(i+1)}) ul&quot;</span>
      <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">el</span>
      <span class="vi">@active_panel = </span><span class="nx">el</span>
      <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s2">&quot;#{@options.pages[i][&#39;id&#39;]}-panel&quot;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;panels&#39;</span><span class="p">)</span>
      <span class="nx">@controls</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages_options</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;slide_horizontal&#39;</span><span class="p">,</span> <span class="nf">(e,d,dir) -&gt;</span>
          <span class="nx">ref</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">if</span> <span class="nx">dir</span> <span class="o">==</span> <span class="s1">&#39;next&#39;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Disable all panels, preventing any loading or key-driven actions from taking place within any amplePanels instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">disable_panels: </span><span class="o">-&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;disable_panels()&quot;</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nx">@controls</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span> <span class="nf">(i,el) -&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">ref</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;disable&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Enable panels instance contained with page identified by <code>i</code>. 
This allows key-events and previous/next actions to be executed. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">enable_panel: </span><span class="nf">(i) -&gt;</span>  
    <span class="nx">@log</span> <span class="s2">&quot;enable_panel(#{i})&quot;</span>
    <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]</span>
      <span class="vi">@active_panel = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;panel_selector&#39;</span><span class="p">]).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;enable&#39;</span><span class="p">)</span> 
      <span class="nx">@controls</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Toggles display of left/right arrows which control amplePanels paging event, determined by <code>display</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">controls: </span><span class="nf">(display=true) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;controls(#{display})&quot;</span>
    <span class="nv">display = </span><span class="kc">false</span> <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="nx">@active_panel</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages_options</span><span class="p">.</span><span class="nx">per_page</span>
    <span class="k">switch</span> <span class="nx">display</span>
      <span class="k">when</span> <span class="kc">true</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;nav.controls&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
      <span class="k">when</span> <span class="kc">false</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;nav.controls&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Evaluates whether URL attached to page <code>i</code> has been loaded yet. Returns <code>boolean</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">already_loaded: </span><span class="nf">(i) -&gt;</span>
    <span class="k">typeof</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;loaded&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;boolean&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;loaded&#39;</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Removes the asset from drop-target identified by <code>el</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">remove: </span><span class="nf">(el) -&gt;</span>
    <span class="nv">parent = </span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">parent</span><span class="p">()</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.droppable&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">().</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;Drag Asset Here&lt;/span&gt;&#39;</span><span class="p">)</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Called upon successful DELETE request for a specific asset. Removes any instances of
asset identified by <code>id</code>, closes the modal window and reloads the first tab.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">delete</span><span class="o">:</span> <span class="nf">(id) -&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;delete(#{id})&quot;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;a#file-#{id}&quot;</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">remove</span><span class="p">()</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;close.facebox&#39;</span><span class="p">)</span>
    <span class="nx">@reload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Upon collapse, we disable panels.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">collapse: </span><span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id}-handle&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">35</span><span class="p">).</span><span class="nx">show</span><span class="p">().</span><span class="nx">animate</span><span class="p">({</span><span class="s1">&#39;bottom&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">},</span><span class="s1">&#39;fast&#39;</span><span class="p">)</span>
    <span class="nx">@disable_panels</span><span class="p">()</span>
  </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Expands the asset toolbar and reenables the currently loaded tab. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">expand: </span><span class="o">-&gt;</span>
    <span class="nx">@goto</span><span class="p">(</span><span class="nx">@current</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Setup all associated events.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">events: </span><span class="o">-&gt;</span>
    <span class="nx">@modal_events</span><span class="p">()</span>
    <span class="nx">@global_events</span><span class="p">()</span>
    <span class="nx">@field_events</span><span class="p">()</span>
    <span class="nx">@drop_events</span><span class="p">()</span>
    <span class="nx">@drag_events</span><span class="p">()</span>
    <span class="nx">@reload_events</span><span class="p">()</span>
    <span class="nx">@resize_events</span><span class="p">()</span>
    <span class="nx">@key_events</span><span class="p">()</span>
    <span class="nx">@tab_events</span><span class="p">()</span>
    <span class="nv">ref = </span><span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Collapse toolbar</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id} a.collapse&quot;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nx">@toggle</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Reload the first tab following a successful upload. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">bind</span> <span class="s1">&#39;ample_uploadify.complete&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nx">@reload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Bind event to succesful deletion of an asset.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;a.asset-delete&quot;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;ajax:success&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">id = </span><span class="nb">parseInt</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">)</span>
      <span class="nx">ref</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Bind live event to any asset-remove element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;a.asset-remove&quot;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">ref</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
      <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Bind <code>toggle()</code> method to toolbar handle.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id}-handle&quot;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nx">@toggle</span><span class="p">()</span>
      <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Bind events for global left/right arrows to currently active panel's <code>previous()</code> and <code>next()</code> methods. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">global_events: </span><span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a.global.next&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">@active_panel</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a.global.previous&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="o">=&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">@active_panel</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;previous&#39;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>TODO: kill key events during drag?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drag_events: </span><span class="o">-&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;drag_events()&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Open modal window when clicking an asset contained with a drop-target.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">drop_events: </span><span class="o">-&gt;</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.asset-drop .droppable a&#39;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nv">id = </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">get</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">),</span> <span class="nf">(response) -&gt;</span>
        <span class="nx">ref</span><span class="p">.</span><span class="nx">modal_open</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="p">,</span> <span class="s1">&#39;json&#39;</span>
      <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Toggle the active state of key_events when user focuses / blurs on textareas or input fields.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">field_events: </span><span class="o">-&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;field_events()&quot;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;textarea, input&#39;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="vi">@keys_enabled = </span><span class="kc">true</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;textarea, input&#39;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;focus&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="vi">@keys_enabled = </span><span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Bind <code>reload()</code> method to assets-reload button. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">reload_events: </span><span class="o">-&gt;</span>
    <span class="nx">@log</span> <span class="s2">&quot;reload_events()&quot;</span>
    <span class="nv">reload = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;#&quot; class=&quot;assets-reload&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;&#39;</span><span class="p">)</span>
    <span class="nx">reload</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;.asset-refresh&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@reload</span><span class="p">(</span><span class="nx">@current</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Builds the markup for an asset dropped into a textarea. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resize_events: </span><span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.asset-resize&#39;</span><span class="p">).</span><span class="nx">live</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nv">constraints = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#asset-constraints&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">uid = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#asset-uid&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">width = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#asset-width&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">height = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#asset-height&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">alt = </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#asset-alt&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">geometry = </span><span class="s2">&quot;#{width}x#{height}#{constraints}&quot;</span>
      <span class="k">if</span> <span class="nx">constraints</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">width</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">height</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nx">alert</span> <span class="s1">&#39;Can\&#39;t resize image using this geometry. Please select another option or supply a value for both width and height.&#39;</span>
      <span class="k">else</span> 
        <span class="nv">url = </span><span class="nb">encodeURI</span> <span class="s2">&quot;#{@options.base_url}#{@options.thumb_url}/#{geometry}?uid=#{uid}&quot;</span>
        <span class="nv">url = </span><span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="s1">&#39;%23&#39;</span><span class="p">)</span>
        <span class="nv">textile = </span><span class="s2">&quot;!#{url}(#{alt})!&quot;</span>
        <span class="nv">html = </span><span class="s2">&quot;&lt;img src=\&quot;#{url}\&quot; alt=\&quot;#{alt}\&quot; /&gt;&quot;</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">@target_textarea</span><span class="p">).</span><span class="nx">insertAtCaret</span> <span class="p">(</span><span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="nx">@target_textarea</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;textile&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="nx">textile</span> <span class="k">else</span> <span class="nx">html</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;close.facebox&#39;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Toggles params when modal window is opened or closed. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">modal_events: </span><span class="o">-&gt;</span>
    <span class="vi">@modal_active = </span><span class="kc">false</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span> <span class="s1">&#39;afterClose.facebox&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="vi">@keys_enabled = </span><span class="kc">true</span>
      <span class="vi">@modal_active = </span><span class="kc">false</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span> <span class="s1">&#39;loading.facebox&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="vi">@keys_enabled = </span><span class="kc">false</span>
      <span class="vi">@modal_active = </span><span class="kc">true</span>
  </pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Setup amplePanels instance for search results and bind search field to methods that 
execute request and parse response. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">search: </span><span class="o">-&gt;</span>
    <span class="nx">@log</span> <span class="s1">&#39;search()&#39;</span>
    <span class="nv">search_url = </span><span class="s2">&quot;#{@options.base_url}#{@options.search_url}&quot;</span>
    <span class="nv">i = </span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id} .pages .page&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#asset-results ul&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;assets-result-list&#39;</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">pages_options</span><span class="p">)</span>
    <span class="nx">@options</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nv">loaded: </span><span class="kc">true</span> <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#asset-search&#39;</span><span class="p">).</span><span class="nx">bind</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#asset-results ul&quot;</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">)</span>
      <span class="nx">ref</span><span class="p">.</span><span class="nx">loading</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">ref</span><span class="p">.</span><span class="nx">controls</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
      <span class="nx">ref</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nx">ref</span><span class="p">.</span><span class="nx">activate</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
      <span class="nv">ref.searching = </span><span class="kc">true</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.asset-results&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">post</span> <span class="nx">search_url</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">serialize</span><span class="p">(),</span> <span class="nf">(response) -&gt;</span>
        <span class="nx">ref</span><span class="p">.</span><span class="nx">load_results</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="p">,</span> <span class="s1">&#39;json&#39;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Bind events to tabs. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tab_events: </span><span class="o">-&gt;</span>
    <span class="nv">tabs = </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;##{@options.id} a.tab&quot;</span><span class="p">)</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span> <span class="nx">tabs</span><span class="p">,</span> <span class="nf">(idx, el) -&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">idx</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">click</span> <span class="o">-&gt;</span>
        <span class="nx">ref</span><span class="p">.</span><span class="nx">goto</span><span class="p">(</span><span class="nx">idx</span><span class="p">)</span>
        <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Controls all user keyboard events. Binds as neccesary and 
prevents interaction when key functions are disabled. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">key_events: </span><span class="o">-&gt;</span>
    <span class="nv">ref = </span><span class="k">this</span>
    <span class="nv">previous = </span><span class="mi">37</span>
    <span class="nv">next = </span><span class="mi">39</span>
    <span class="nv">up = </span><span class="mi">38</span>
    <span class="nv">down = </span><span class="mi">40</span>
    <span class="nv">escape = </span><span class="mi">27</span>
    </pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Why does this need to be on keyup?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">keyup</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@keys_enabled</span>
      <span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span>
        <span class="k">when</span> <span class="nx">escape</span>
          <span class="nx">@toggle</span><span class="p">()</span> <span class="nx">unless</span> <span class="nx">@modal_active</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Keydown events.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">keydown</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@keys_enabled</span>
      <span class="k">if</span> <span class="nx">@active_panel</span>
        <span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span>
          <span class="k">when</span> <span class="nx">previous</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">@active_panel</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;previous&#39;</span><span class="p">)</span>
          <span class="k">when</span> <span class="nx">next</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">@active_panel</span><span class="p">).</span><span class="nx">amplePanels</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span>
          <span class="k">when</span> <span class="nx">up</span>
            <span class="nx">@previous</span><span class="p">()</span>
          <span class="k">when</span> <span class="nx">down</span>
            <span class="nx">@next</span><span class="p">()</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  </pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Returns Mustache template for template defined by <code>view</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tpl: </span><span class="nf">(view) -&gt;</span>
    <span class="nx">@tpls</span><span class="p">()[</span><span class="nx">view</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Returns object containing all Mustache templates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tpls: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Layout returns the HTML structure of the main asset toolbar.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">layout: </span><span class="s1">&#39;</span>
<span class="s1">    &lt;div id=&quot;{{ id }}&quot;&gt;&lt;div class=&quot;background&quot;&gt;</span>
<span class="s1">      &lt;a href=&quot;#&quot; class=&quot;collapse&quot;&gt;Close&lt;/a&gt;</span>
<span class="s1">      &lt;div class=&quot;container&quot;&gt;</span>
<span class="s1">        &lt;div id=&quot;{{ id }}-tabs&quot; class=&quot;tabs&quot;&gt;</span>
<span class="s1">          &lt;div class=&quot;asset-refresh&quot;&gt;&lt;/div&gt;</span>
<span class="s1">          &lt;div class=&quot;asset-search&quot;&gt;</span>
<span class="s1">            &lt;input type=&quot;text&quot; id=&quot;asset-search&quot; name=&quot;q&quot; placeholder=&quot;Enter keywords...&quot; /&gt;</span>
<span class="s1">            &lt;label for=&quot;asset-search&quot;&gt;Search&lt;/label&gt;</span>
<span class="s1">          &lt;/div&gt;</span>
<span class="s1">          {{{ tabs }}}</span>
<span class="s1">          &lt;a href=&quot;#&quot; data-role=&quot;asset-search-results&quot; class=&quot;tab asset-results&quot;&gt;Results&lt;/a&gt;</span>
<span class="s1">          &lt;span class=&quot;asset-loading&quot;&gt;&lt;/span&gt;</span>
<span class="s1">        &lt;/div&gt;</span>
<span class="s1">        &lt;div id=&quot;{{ id }}-pages&quot; class=&quot;pages&quot;&gt;</span>
<span class="s1">          {{{ pages }}}</span>
<span class="s1">          &lt;div id=&quot;asset-results&quot; class=&quot;page panels&quot;&gt;</span>
<span class="s1">            &lt;ul&gt;&lt;/ul&gt;</span>
<span class="s1">          &lt;/div&gt;</span>
<span class="s1">        &lt;/div&gt;</span>
<span class="s1">        &lt;nav class=&quot;controls&quot;&gt;</span>
<span class="s1">          &lt;a href=&quot;#&quot; class=&quot;global previous&quot;&gt;Previous&lt;/a&gt;</span>
<span class="s1">          &lt;a href=&quot;#&quot; class=&quot;global next&quot;&gt;Next&lt;/a&gt;</span>
<span class="s1">        &lt;/nav&gt;</span>
<span class="s1">      &lt;/div&gt;&lt;/div&gt;</span>
<span class="s1">    &lt;/div&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Handle returns HTML for the asset toolbar toggle handle.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">handle: </span><span class="s1">&#39;&lt;a href=&quot;#&quot; id=&quot;{{ id }}-handle&quot; class=&quot;handle&quot;&gt;{{ title }}&lt;/a&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Tab returns HTML for each tab instance. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">tab: </span><span class="s1">&#39;&lt;a href=&quot;#&quot; data-role=&quot;{{ id }}&quot; class=&quot;tab {{ classes }}&quot;&gt;{{ title }}&lt;/a&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Page returns generic HTML structure for each page.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">page: </span><span class="s1">&#39;</span>
<span class="s1">    &lt;div id=&quot;{{ id }}&quot; class=&quot;page&quot;&gt;</span>
<span class="s1">      &lt;ul&gt;&lt;/ul&gt;</span>
<span class="s1">    &lt;/div&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Show represents the HTML used within the modal window detail view for non-document assets.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">show: </span><span class="s1">&#39;</span>
<span class="s1">    &lt;div class=&quot;asset-detail&quot;&gt;</span>
<span class="s1">      &lt;div class=&quot;asset-media {{ orientation }}&quot;&gt;</span>
<span class="s1">        &lt;img src=&quot;{{ src }}&quot; /&gt;</span>
<span class="s1">      &lt;/div&gt;</span>
<span class="s1">      &lt;input id=&quot;file_attachment_gravity&quot; name=&quot;file[attachment_gravity]&quot; type=&quot;hidden&quot; value=&quot;{{ gravity }}&quot;&gt;</span>
<span class="s1">      &lt;div id=&quot;asset-gravity-handle&quot; style=&quot;display:none&quot; data-role=&quot;gravity&quot;&gt;&lt;/div&gt;</span>
<span class="s1">      &lt;script type=&quot;text/javascript&quot;&gt;</span>
<span class="s1">        $(document).ready(function() {</span>
<span class="s1">        	new AmpleAssetsGravity({url: &quot;{{ gravity_url }}&quot;, uid: &quot;{{ uid }}&quot;});</span>
<span class="s1">        });</span>
<span class="s1">      &lt;/script&gt;</span>
<span class="s1">      &lt;div id=&quot;asset-gravity-notification&quot;&gt;Asset updated successfully.&lt;/div&gt;</span>
<span class="s1">      &lt;a href=&quot;{{ delete_url }}&quot; class=&quot;asset-delete&quot; data-id=&quot;{{ id }}&quot; data-method=&quot;delete&quot; data-confirm=&quot;Are you sure?&quot; data-remote=&quot;true&quot;&gt;Delete This Asset?&lt;/a&gt;</span>
<span class="s1">      &lt;h3&gt;{{ filename }}&lt;/h3&gt;&lt;hr /&gt;</span>
<span class="s1">      &lt;ul&gt;</span>
<span class="s1">        &lt;li&gt;Original Dimensions: &lt;strong&gt;{{ size }}&lt;/strong&gt;&lt;/li&gt;</span>
<span class="s1">        &lt;li&gt;MimeType: &lt;strong&gt;{{ mime_type }}&lt;/strong&gt;&lt;/li&gt;</span>
<span class="s1">        &lt;li&gt;Orientation: &lt;strong&gt;{{ orientation }}&lt;/strong&gt;&lt;/li&gt;</span>
<span class="s1">      &lt;/ul&gt;</span>
<span class="s1">      &lt;p&gt;{{ keywords }}&lt;/p&gt;</span>
<span class="s1">    &lt;/div&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>PDF represents the HTML used within the modal window detail view for document assets.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">pdf: </span><span class="s1">&#39;</span>
<span class="s1">    &lt;div class=&quot;asset-detail&quot;&gt;</span>
<span class="s1">      &lt;div id=&quot;pdf&quot; class=&quot;asset-media&quot;&gt;&lt;/div&gt;</span>
<span class="s1">        &lt;a href=&quot;{{ delete_url }}&quot; class=&quot;asset-delete&quot; data-id=&quot;{{ id }}&quot; data-method=&quot;delete&quot; data-confirm=&quot;Are you sure?&quot; data-remote=&quot;true&quot;&gt;Delete This Asset?&lt;/a&gt;</span>
<span class="s1">        &lt;h3&gt;{{ filename }}&lt;/h3&gt;&lt;hr /&gt;</span>
<span class="s1">        &lt;ul&gt;</span>
<span class="s1">          &lt;li&gt;MimeType: &lt;strong&gt;{{ mime_type }}&lt;/strong&gt;&lt;/li&gt;</span>
<span class="s1">        &lt;/ul&gt;</span>
<span class="s1">        &lt;p&gt;{{ keywords }}&lt;/p&gt;</span>
<span class="s1">    &lt;/div&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>There's no content within this panels instance... </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">empty: </span><span class="s1">&#39;&lt;li class=&quot;empty&quot;&gt;Oops. There\&#39;s nothing here. You should &lt;a href=&quot;#&quot;&gt;upload something&lt;/a&gt;.&lt;/li&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Your search query returned an empty result set...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">no_results: </span><span class="s1">&#39;&lt;li class=&quot;empty&quot;&gt;Sorry. Your search returned zero results.&lt;/li&gt;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Drop returns HTML used in the modal window resize view. This is used when dropping an asset onto a textarea.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">drop: </span><span class="s1">&#39;</span>
<span class="s1">    &lt;div class=&quot;asset-selection&quot;&gt;</span>
<span class="s1">      &lt;div class=&quot;asset-media {{ orientation }}&quot;&gt;</span>
<span class="s1">        &lt;img src=&quot;{{ src }}&quot; /&gt;</span>
<span class="s1">      &lt;/div&gt;</span>
<span class="s1">      &lt;div class=&quot;asset-dimensions&quot;&gt;</span>
<span class="s1">        &lt;p&gt;&lt;label&gt;Image Dimensions&lt;/label&gt; ({{ dimensions }}, {{ orientation }})&lt;/p&gt;</span>
<span class="s1">        &lt;p&gt;&lt;select id=&quot;asset-constraints&quot; name=&quot;asset-constraints&quot;&gt;</span>
<span class="s1">            &lt;option value=&quot;&quot;&gt;Maintain aspect ratio&lt;/option&gt;</span>
<span class="s1">            &lt;option value=&quot;!&quot;&gt;Force resize, don\&#39;t maintain aspect ratio&lt;/option&gt;</span>
<span class="s1">            &lt;option value=&quot;&gt;&quot;&gt;Resize only if image larger than this&lt;/option&gt;</span>
<span class="s1">            &lt;option value=&quot;&lt;&quot;&gt;Resize only if image smaller than this&lt;/option&gt;</span>
<span class="s1">            &lt;option value=&quot;^&quot;&gt;Resize to minimum x,y, maintain aspect ratio&lt;/option&gt;</span>
<span class="s1">            &lt;option value=&quot;#&quot;&gt;Resize, crop if necessary to maintain aspect ratio&lt;/option&gt;</span>
<span class="s1">           &lt;/select&gt;&lt;/p&gt;</span>
<span class="s1">        &lt;p&gt;&lt;input type=&quot;hidden&quot; id=&quot;asset-dimensions-target&quot; name=&quot;asset-dimensions-target&quot; value=&quot;&quot; /&gt;</span>
<span class="s1">           &lt;input type=&quot;hidden&quot; id=&quot;asset-uid&quot; name=&quot;asset-uid&quot; value=&quot;{{ uid }}&quot; /&gt;</span>
<span class="s1">           &lt;input type=&quot;text&quot; id=&quot;asset-width&quot; name=&quot;asset-width&quot; value=&quot;480&quot; /&gt; &lt;span&gt;x&lt;/span&gt; </span>
<span class="s1">           &lt;input type=&quot;text&quot; id=&quot;asset-height&quot; name=&quot;asset-height&quot; value=&quot;&quot; /&gt;&lt;br /&gt;</span>
<span class="s1">           &lt;input type=&quot;text&quot; id=&quot;asset-alt&quot; name=&quot;asset-alt&quot; value=&quot;&quot; placeholder=&quot;Alt text&quot; /&gt;</span>
<span class="s1">           &lt;input type=&quot;submit&quot; id=&quot;asset-resize&quot; name=&quot;asset-resize&quot; class=&quot;asset-resize&quot; value=&quot;Insert&quot; /&gt;&lt;/p&gt;</span>
<span class="s1">        </span>
<span class="s1">      &lt;/div&gt;</span>
<span class="s1">      &lt;hr class=&quot;space&quot; /&gt;</span>
<span class="s1">    &lt;/div&gt;&#39;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Extend draggable to elements added to the DOM after page load. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">jQuery.fn.liveDraggable = </span><span class="nf">(opts) -&gt;</span>
  <span class="nx">@live</span> <span class="s2">&quot;mouseover&quot;</span><span class="p">,</span> <span class="o">-&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">draggable</span> <span class="nx">opts</span>  <span class="nx">unless</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;init&quot;</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Insert <code>value</code> at the cursor position of the currently focused textarea or input field.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">jQuery.fn.insertAtCaret = </span><span class="nf">(value) -&gt;</span>
  <span class="nx">@each</span> <span class="nf">(i) -&gt;</span>
    <span class="k">if</span> <span class="nb">document</span><span class="p">.</span><span class="nx">selection</span>
      <span class="nx">@focus</span><span class="p">()</span>
      <span class="nv">sel = </span><span class="nb">document</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">createRange</span><span class="p">()</span>
      <span class="nv">sel.text = </span><span class="nx">value</span>
      <span class="nx">@focus</span><span class="p">()</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">@selectionStart</span> <span class="o">or</span> <span class="nx">@selectionStart</span> <span class="o">is</span> <span class="s2">&quot;0&quot;</span>
      <span class="nv">startPos = </span><span class="nx">@selectionStart</span>
      <span class="nv">endPos = </span><span class="nx">@selectionEnd</span>
      <span class="nv">scrollTop = </span><span class="nx">@scrollTop</span>
      <span class="vi">@value = </span><span class="nx">@value</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">startPos</span><span class="p">)</span> <span class="o">+</span> <span class="nx">value</span> <span class="o">+</span> <span class="nx">@value</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">endPos</span><span class="p">,</span> <span class="nx">@value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
      <span class="nx">@focus</span><span class="p">()</span>
      <span class="vi">@selectionStart = </span><span class="nx">startPos</span> <span class="o">+</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span>
      <span class="vi">@selectionEnd = </span><span class="nx">startPos</span> <span class="o">+</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span>
      <span class="vi">@scrollTop = </span><span class="nx">scrollTop</span>
    <span class="k">else</span>
      <span class="nx">@value</span> <span class="o">+=</span> <span class="nx">value</span>
      <span class="nx">@focus</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 